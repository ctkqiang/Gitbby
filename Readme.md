# ğŸŒ¸ Gitbby - GitHub Webhook æ¶ˆæ¯ç›‘å¬å™¨ï¼ˆRuby + Sinatraï¼‰

> è½»é‡ã€æ¨¡å—åŒ–ã€é«˜æ‰©å±•æ€§çš„ GitHub Webhook äº‹ä»¶å¤„ç†å™¨ï¼Œä¸“ä¸º Pull Request å’Œ Issue åœºæ™¯è®¾è®¡ã€‚

---

## ğŸ“Œ é¡¹ç›®ç®€ä»‹

**Gitbby** æ˜¯ä¸€ä¸ªç”¨ Ruby ç¼–å†™çš„ Webhook æ¥æ”¶å¤„ç†å™¨ï¼ŒåŸºäº Sinatra æ¡†æ¶å®ç°ã€‚å®ƒç›‘å¬æ¥è‡ª GitHub çš„äº‹ä»¶ï¼ˆå¦‚æ–°å»º PR / Issueï¼‰ï¼Œå¹¶ç«‹å³åœ¨æœ¬åœ°è¾“å‡ºæ¶ˆæ¯ï¼Œä¾›ä½ æ¥å…¥åç»­è‡ªåŠ¨åŒ–é€»è¾‘ã€‚

å…¸å‹ç”¨é€”åŒ…æ‹¬ï¼š

- PR/Issue åˆ›å»ºæ—¶ç¬¬ä¸€æ—¶é—´é€šçŸ¥
- è‡ªå®šä¹‰è‡ªåŠ¨å›å¤é€»è¾‘
- æ¥å…¥æœ¬åœ° CI / æ¶ˆæ¯é€šçŸ¥ / æ•°æ®åˆ†ææµç¨‹

> çµæ´»æ€§å¼ºã€éƒ¨ç½²ç®€å•ï¼Œæ˜¯æ„å»ºå¼€å‘è€…å·¥å…·é“¾çš„ç»ä½³åŸºç¡€è®¾æ–½ç»„ä»¶ã€‚

---

## ğŸ§± é¡¹ç›®ç»“æ„

```bash
Gitbby/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ handlers/              # æ¯ç±»äº‹ä»¶çš„ç‹¬ç«‹å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ issue_handler.rb
â”‚   â”‚   â””â”€â”€ pull_request_handler.rb
â”‚   â””â”€â”€ router.rb              # è·¯ç”±å±‚ï¼šæŒ‰äº‹ä»¶åˆ†å‘åˆ°å¤„ç†å™¨
â”œâ”€â”€ main.rb                    # Sinatra ä¸»ç¨‹åº
â”œâ”€â”€ Gemfile                    # Ruby ä¾èµ–
â””â”€â”€ .env                       # æœ¬åœ°é…ç½®ï¼ˆå¿½ç•¥ç‰ˆæœ¬æ§åˆ¶ï¼‰
````

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/ctkqiang/Gitbby.git
cd Gitbby
```

### 2ï¸âƒ£ å®‰è£…ä¾èµ–

```bash
bundle install
```

### 3ï¸âƒ£ é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶å¹¶è®¾ç½® GitHub Tokenï¼š

```env
GITHUB_TOKEN=ghp_ä½ çš„GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ
```

* Token éœ€è¦å…·å¤‡ `repo` æƒé™ï¼ˆç”¨äºæœªæ¥è°ƒç”¨ GitHub APIï¼‰
* å»ºè®®ä½¿ç”¨ [dotenv](https://github.com/bkeepers/dotenv) ç®¡ç†é…ç½®ï¼Œé¿å…ç¡¬ç¼–ç 

### 4ï¸âƒ£ å¯åŠ¨æœ¬åœ°æœåŠ¡

```bash
ruby gitbby.rb
```

é»˜è®¤ç›‘å¬åœ°å€ä¸ºï¼š`http://localhost:9292`

---

## ğŸŒ é…ç½®å…¬ç½‘è®¿é—®ï¼ˆNgrokï¼‰

```bash
ngrok authtoken <ä½ çš„Ngrok Token>
ngrok http 9292
```

å°†å¾—åˆ°ä¸€ä¸ªå…¬ç½‘åœ°å€ï¼ˆå¦‚ `https://xxxxx.ngrok.io`ï¼‰ï¼Œç”¨äº GitHub Webhookã€‚

---

## ğŸª GitHub Webhook é…ç½®æŒ‡å—

1. æ‰“å¼€ GitHub ä»“åº“ â†’ Settings â†’ Webhooks

2. æ·»åŠ æ–°çš„ Webhook

3. Payload URL å¡«å†™ï¼š

   ```
   https://<ä½ çš„-ngrok-url>/githook
   ```

4. Content type é€‰æ‹© `application/json`

5. å‹¾é€‰äº‹ä»¶ï¼š

   * Issues
   * Pull requests

6. ä¿å­˜å¹¶æµ‹è¯•è§¦å‘ ğŸ¯

---

## ğŸ› ï¸ è‡ªå®šä¹‰äº‹ä»¶é€»è¾‘

ä½ å¯ä»¥åœ¨ä»¥ä¸‹è·¯å¾„ä¸­æ·»åŠ æˆ–æ‰©å±•ä¸šåŠ¡é€»è¾‘ï¼š

* `app/handlers/issue_handler.rb`
* `app/handlers/pull_request_handler.rb`

å®ƒä»¬å°†ä¼šæ ¹æ®äº‹ä»¶è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œä¾‹å¦‚ï¼š

```ruby
module Gitbby
  class IssueHandler
    def self.handle(payload)
      puts "[Issue] New: #{payload['issue']['title']}"
    end
  end
end
```

å°†æ¥å¯æ·»åŠ é€»è¾‘å¦‚ï¼š

* è‡ªåŠ¨è¯„è®º
* æ‰“æ ‡ç­¾
* åˆ†é… reviewer
* æ•°æ®å­˜å‚¨ç­‰

---

## ğŸ§© æ¶æ„åŸåˆ™ï¼ˆå¯æ‹“å±•ï¼‰

| å±‚çº§            | è¯´æ˜                  |
| ------------- | ------------------- |
| Sinatra æ§åˆ¶å™¨   | æ¥æ”¶å¹¶è§£æ Webhook è¯·æ±‚    |
| Router åˆ†å‘å™¨    | æ ¹æ®äº‹ä»¶ç±»å‹è¿›è¡Œ handler åˆ†å‘ |
| Handlers      | æ¯ç±»äº‹ä»¶çš„ä¸šåŠ¡å¤„ç†é€»è¾‘         |
| GitHub Client | å¯é€‰ï¼Œç”¨äºåç»­ API æ“ä½œï¼ˆè¯„è®ºç­‰ï¼‰ |

---

## ğŸ§ª æœ¬åœ°æµ‹è¯•

1. æ‰‹åŠ¨å‘èµ·ä¸€ä¸ª PR æˆ– Issue
2. æŸ¥çœ‹ç»ˆç«¯è¾“å‡ºæ˜¯å¦æ­£ç¡®è§¦å‘å¯¹åº”äº‹ä»¶
3. åç»­å¯ä»¥ mock payload è°ƒè¯•å„ç±»é€»è¾‘

---

## âœ… è¿›é˜¶åŠŸèƒ½å»ºè®®ï¼ˆTodoï¼‰

* [ ] æ”¯æŒæ›´å¤š GitHub äº‹ä»¶ç±»å‹ï¼ˆå¦‚ pushã€commentsï¼‰
* [ ] å¢åŠ æµ‹è¯•ç”¨ä¾‹ï¼ˆRSpec or Minitestï¼‰
* [ ] GitHub Action è‡ªåŠ¨éƒ¨ç½²

---

æœ‰é—®é¢˜æ¬¢è¿æ Issueï¼Œä¸€èµ·æ‰“é€  Ruby ä¸–ç•Œæœ€ç”œ Webhook æ ¸å¿ƒ ğŸ’˜

---
